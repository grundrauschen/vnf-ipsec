# ipsec.conf - strongSwan IPsec configuration file

# basic configuration

config setup
	# strictcrlpolicy=yes
	# uniqueids = no

# Add connections here.

# Sample VPN connections

#conn sample-self-signed
#      leftsubnet=10.1.0.0/16
#      leftcert=selfCert.der
#      leftsendcert=never
#      right=192.168.0.2
#      rightsubnet=10.2.0.0/16
#      rightcert=peerCert.der
#      auto=start

#conn sample-with-ca-cert
#      leftsubnet=10.1.0.0/16
#      leftcert=myCert.pem
#      right=192.168.0.2
#      rightsubnet=10.2.0.0/16
#      rightid="C=CH, O=Linux strongSwan CN=peer name"
#      auto=start

{{ range gets "/configs/1/*" }}
{{ .Key }}
{{ .Value }}
{{ end }}

{{ if exists "/numcodfasdfnf" }}
testitest
{{getv "/configs/1/ikecipher"}}
testi2
conn site-static-ip-{{ .Key }}
	fragmentation=yes
	dpdaction=restart
	ike={{ .Value.ikecipher }}
	esp={{ .Value.espcipher }}
	keyingtries=%forever
	forceencaps={{ .Value.forceudp }}
	lifetime={{ .Value.lifetime }}
	ikelifetime={{ .Value.ikelifetime }}
	reauth={{ .Value.ikereauth }}
	keyexchange={{ .Value.keyexchange }}
	leftsubnet={{ .Value.localnet }}
	left={{ .Value.localip }}
	leftid={{ .Value.localid }}
	rightsubnet={{ .Value.remotenet }}
	right={{ .Value.remoteip }}
	rightid={{ .Value.remoteid }}
	auto=route
	leftauth=psk
	rightauth=psk
	{{if exists .Value.vti.key -}}
	mark={{ .Value.vti.key }}
	{{- end}}
conn site-static-ip
	fragmentation=yes
	dpdaction=restart
	ike={{getv "/ikecipher"}}
	esp={{getv "/espcipher"}}
	keyingtries=%forever
	forceencaps={{getv "/forceudp" "yes"}}
	lifetime={{getv "/lifetime" "3600"}}
	ikelifetime={{getv "/ikelifetime" "10800"}}
	reauth={{getv "/ikereauth" "yes"}}
	keyexchange={{getv "/keyexchange"}}
	leftsubnet={{getv "/localnet"}}
	left={{getv "/localip"}}
	leftid={{getv "/localid"}}
	rightsubnet={{getv "/remotenet"}}
	right={{getv "/remoteip"}}
	rightid={{getv "/remoteid"}}
	auto=route
	leftauth=psk
	rightauth=psk
	{{if exists "/vti/key" -}}
	mark={{getv "/vti/key"}}
	{{- end}}
{{- end }}
